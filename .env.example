# ============================================================================
# Obiente Cloud - Complete Environment Variables Reference
# ============================================================================
# Copy this file to .env and customize with your values
# For detailed documentation, see: docs/reference/environment-variables.md
# ============================================================================

# ============================================================================
# DATABASE CONFIGURATION (PostgreSQL - Main Database)
# ============================================================================

# PostgreSQL superuser credentials
# Used for main database connection (application metadata)
POSTGRES_USER=obiente
POSTGRES_PASSWORD=CHANGE_ME_STRONG_PASSWORD_HERE
POSTGRES_DB=obiente

# Database connection details (usually auto-detected from service names)
# DB_HOST=postgres              # Service name in docker-compose / swarm
# DB_PORT=5432                  # PostgreSQL port
# DB_USER=${POSTGRES_USER}      # Usually same as POSTGRES_USER
# DB_PASSWORD=${POSTGRES_PASSWORD}  # Usually same as POSTGRES_PASSWORD
# DB_NAME=${POSTGRES_DB}        # Usually same as POSTGRES_DB

# ============================================================================
# METRICS DATABASE CONFIGURATION (TimescaleDB - Time-Series Database)
# ============================================================================

# Metrics database credentials (separate from main PostgreSQL)
# TimescaleDB is optimized for time-series metrics storage
METRICS_DB_USER=${POSTGRES_USER:-postgres}
METRICS_DB_PASSWORD=${POSTGRES_PASSWORD:-postgres}
METRICS_DB_NAME=obiente_metrics

# Metrics database connection (usually auto-detected from service names)
# METRICS_DB_HOST=timescaledb        # Service name in docker-compose
# METRICS_DB_HOST=metrics-pgpool     # Service name in HA swarm setup
# METRICS_DB_PORT=5432               # PostgreSQL/TimescaleDB port

# ============================================================================
# HIGH AVAILABILITY DATABASE CONFIGURATION (Patroni + etcd)
# ============================================================================

# PostgreSQL replication credentials (HA deployments only)
REPLICATION_PASSWORD=CHANGE_ME_REPLICATION_PASSWORD_HERE
PATRONI_ADMIN_PASSWORD=CHANGE_ME_PATRONI_PASSWORD_HERE

# Metrics database replication credentials (HA deployments only)
METRICS_REPLICATION_PASSWORD=${REPLICATION_PASSWORD:-CHANGE_ME_REPLICATION_PASSWORD_HERE}
METRICS_PATRONI_ADMIN_PASSWORD=${PATRONI_ADMIN_PASSWORD:-CHANGE_ME_PATRONI_PASSWORD_HERE}

# PgPool connection pooler (HA deployments only)
PGPOOL_ADMIN_PASSWORD=CHANGE_ME_PGPOOL_PASSWORD_HERE
METRICS_PGPOOL_ADMIN_PASSWORD=${PGPOOL_ADMIN_PASSWORD:-CHANGE_ME_PGPOOL_PASSWORD_HERE}

# ============================================================================
# API CONFIGURATION
# ============================================================================

# API server port (default: 3001)
GO_API_PORT=3001

# Logging level: debug, info, warn, error (default: debug)
# Use "info" or "warn" in production to reduce log verbosity
LOG_LEVEL=debug

# ============================================================================
# METRICS COLLECTION CONFIGURATION
# ============================================================================

# Collection and storage intervals
# How often to collect metrics from containers (default: 5s)
METRICS_COLLECTION_INTERVAL=5s

# How often to batch write aggregated metrics to database (default: 60s)
METRICS_STORAGE_INTERVAL=60s

# How long to keep live metrics in memory cache (default: 5m)
METRICS_LIVE_RETENTION=5m

# Performance tuning
# Maximum parallel workers for stats collection (default: 50)
# Increase for high-throughput scenarios with many containers
METRICS_MAX_WORKERS=50

# Batch size for database writes (default: 100)
# Larger batches = fewer writes but more memory usage
METRICS_BATCH_SIZE=100

# Memory limits
# Max metrics to keep in memory per deployment (default: 1000)
# About 83 minutes of data at 5s collection interval
METRICS_MAX_LIVE_PER_DEPLOYMENT=1000

# Max container stats to cache for delta calculation (default: 10000)
# About 200 deployments with 50 containers each
METRICS_MAX_PREVIOUS_STATS=10000

# ============================================================================
# METRICS DOCKER API CONFIGURATION
# ============================================================================

# Timeout for Docker API calls when collecting stats (default: 10s)
# Increase for slow Docker hosts or high latency networks
METRICS_DOCKER_API_TIMEOUT=10s

# Retry configuration for failed Docker API calls
# Maximum retry attempts (default: 3)
METRICS_DOCKER_API_RETRY_MAX=3

# Initial backoff delay before first retry (default: 1s)
METRICS_DOCKER_API_RETRY_BACKOFF_INITIAL=1s

# Maximum backoff delay (default: 30s)
METRICS_DOCKER_API_RETRY_BACKOFF_MAX=30s

# ============================================================================
# METRICS CIRCUIT BREAKER CONFIGURATION
# ============================================================================

# Circuit breaker protects Docker API from cascade failures
# Number of failures before opening circuit (default: 5)
# Lower values = more sensitive, opens faster on failures
METRICS_CIRCUIT_BREAKER_FAILURE_THRESHOLD=5

# Cooldown period before attempting half-open state (default: 1m)
# After this time, circuit breaker tests if service recovered
METRICS_CIRCUIT_BREAKER_COOLDOWN=1m

# Successful calls needed in half-open state to close circuit (default: 3)
METRICS_CIRCUIT_BREAKER_HALFOPEN_MAX=3

# ============================================================================
# METRICS HEALTH CHECK CONFIGURATION
# ============================================================================

# How often to run health checks on metrics collection (default: 30s)
METRICS_HEALTH_CHECK_INTERVAL=30s

# Consecutive failures before marking as unhealthy (default: 3)
# Triggers graceful degradation and alerts
METRICS_HEALTH_CHECK_FAILURE_THRESHOLD=3

# ============================================================================
# METRICS BACKPRESSURE & SUBSCRIBER CONFIGURATION
# ============================================================================

# Buffer size for subscriber channels (default: 100)
# Larger buffers handle bursts better but use more memory
METRICS_SUBSCRIBER_BUFFER_SIZE=100

# Time before marking subscriber as slow (default: 5s)
# Slow subscribers are monitored and may be cleaned up
METRICS_SUBSCRIBER_SLOW_THRESHOLD=5s

# How often to cleanup dead/slow subscribers (default: 1m)
METRICS_SUBSCRIBER_CLEANUP_INTERVAL=1m

# ============================================================================
# METRICS RETRY QUEUE CONFIGURATION
# ============================================================================

# Retry configuration for failed database writes
# Maximum retries for failed database writes (default: 5)
METRICS_RETRY_MAX_RETRIES=5

# Interval between retry attempts (default: 1m)
METRICS_RETRY_INTERVAL=1m

# Maximum size of retry queue (default: 10000)
# Older batches are discarded if queue is full
METRICS_RETRY_MAX_QUEUE_SIZE=10000

# ============================================================================
# DEPLOYMENT ORCHESTRATION
# ============================================================================

# Deployment strategy: least-loaded, round-robin, resource-based
# - least-loaded: Deploy to node with least resources (default)
# - round-robin: Cycle through nodes evenly
# - resource-based: Match resources to node capacity
DEPLOYMENT_STRATEGY=least-loaded

# Maximum deployments per node (default: 50)
# Prevents resource exhaustion on individual nodes
MAX_DEPLOYMENTS_PER_NODE=50

# Orchestrator sync interval (default: 30s)
# How often orchestrator syncs with Docker Swarm to detect new containers
ORCHESTRATOR_SYNC_INTERVAL=30s

# Orchestrator sync interval (default: 30s)
# How often orchestrator syncs with Docker Swarm to detect new containers

# Orchestrator sync interval (default: 30s)
# How often orchestrator syncs with Docker Swarm to detect new containers

# ============================================================================
# DOMAIN & SSL CONFIGURATION
# ============================================================================

# Primary base domain used by Traefik routing
# The API will be served at: api.${DOMAIN}
# User deployments can use custom subdomains
DOMAIN=obiente.example.com

# Let's Encrypt email for SSL certificates (required for HTTPS)
# Used for automatic certificate generation via ACME
ACME_EMAIL=admin@example.com

# ============================================================================
# AUTHENTICATION (Zitadel)
# ============================================================================

# Zitadel instance URL (where your Zitadel auth is hosted)
# API will validate tokens against: {ZITADEL_URL}/oidc/v1/userinfo
# Default: https://auth.obiente.cloud
ZITADEL_URL=https://auth.obiente.cloud

# Zitadel Management API token (for user profile updates)
# Required for in-app account editing features
# Get from Zitadel console: Settings > API > Service Users
ZITADEL_MANAGEMENT_TOKEN=

# Development options (NEVER use in production!)
# DISABLE_AUTH=true      # Completely disables authentication
# SKIP_TLS_VERIFY=true   # Skips TLS certificate verification

# ============================================================================
# CORS CONFIGURATION
# ============================================================================

# Comma-separated list of allowed origins for CORS
# Use "*" for all origins (development only) or specify exact origins
# Important: Include port if frontend runs on non-standard port
# Examples:
#   CORS_ORIGIN=https://obiente.example.com,https://dashboard.example.com
#   CORS_ORIGIN=http://localhost:3000
#   CORS_ORIGIN=*  # Development only!
CORS_ORIGIN=https://obiente.example.com,https://dashboard.example.com,http://localhost:3000

# ============================================================================
# EMAIL CONFIGURATION (SMTP)
# ============================================================================

# SMTP server hostname (required to enable email delivery)
# If not set, email features are gracefully disabled
SMTP_HOST=

# SMTP server port (default: 587)
SMTP_PORT=587

# SMTP authentication (if required by your provider)
SMTP_USERNAME=
SMTP_PASSWORD=

# From address for outbound emails (required if SMTP_HOST is set)
SMTP_FROM_ADDRESS=

# From name displayed in emails (default: Obiente Cloud)
SMTP_FROM_NAME=Obiente Cloud

# Reply-to address for email replies (optional)
SMTP_REPLY_TO=

# SMTP configuration options
SMTP_USE_STARTTLS=true
SMTP_SKIP_TLS_VERIFY=false
SMTP_TIMEOUT_SECONDS=10
SMTP_LOCAL_NAME=api.obiente.local

# ============================================================================
# CONSOLE & SUPPORT CONFIGURATION
# ============================================================================

# Dashboard/console URL used in invitation emails and links
# API resolves first non-empty value from: CONSOLE_URL, DASHBOARD_URL, APP_CONSOLE_URL
CONSOLE_URL=https://app.obiente.cloud
# DASHBOARD_URL=https://dashboard.example.com
# APP_CONSOLE_URL=https://app.example.com

# Support contact email displayed in email footers (optional)
SUPPORT_EMAIL=support@obiente.cloud

# Superadmin emails (comma-separated list)
# These emails get global access to Superadmin API and dashboard
# Emails must match your identity provider
SUPERADMIN_EMAILS=

# ============================================================================
# PRICING CONFIGURATION
# ============================================================================

# Resource pricing (used for usage calculations and billing)
# CPU cost per core-second (default: 0.0001)
PRICING_CPU_COST_PER_CORE_SECOND=0.0001

# Memory cost per byte-second (default: 0.00000001)
PRICING_MEMORY_COST_PER_BYTE_SECOND=0.00000001

# Bandwidth cost per byte (default: 0.00000001)
PRICING_BANDWIDTH_COST_PER_BYTE=0.00000001

# Storage cost per byte-month (default: 0.00000001)
PRICING_STORAGE_COST_PER_BYTE_MONTH=0.00000001

# ============================================================================
# SECURITY
# ============================================================================

# JWT secret for token signing (generate with: openssl rand -hex 32)
JWT_SECRET=GENERATE_64_CHAR_RANDOM_STRING_HERE

# Session secret for session encryption (generate with: openssl rand -hex 32)
SESSION_SECRET=GENERATE_64_CHAR_RANDOM_STRING_HERE

# Rate limiting configuration
# Time window for rate limiting in milliseconds (default: 60000 = 1 minute)
RATE_LIMIT_WINDOW_MS=60000

# Maximum requests per window (default: 100)
RATE_LIMIT_MAX=100

# ============================================================================
# LOCAL DEVELOPMENT PORTS (docker-compose.yml only)
# ============================================================================

# Public HTTP/HTTPS ports for Traefik when running locally
# These are bound to localhost, allowing external access
PUBLIC_HTTP_PORT=80
PUBLIC_HTTPS_PORT=443

# Traefik dashboard port (bound to localhost only, not exposed)
PUBLIC_TRAEFIK_DASHBOARD_PORT=8080

# ============================================================================
# MONITORING (Optional - HA deployments)
# ============================================================================

# Grafana admin password (for monitoring dashboards)
# Only used in HA deployments with Grafana service
GRAFANA_PASSWORD=CHANGE_ME_GRAFANA_PASSWORD_HERE

# ============================================================================
# SWARM CONFIGURATION (Docker Swarm only)
# ============================================================================

# Node ID (automatically detected, but can be overridden)
# NODE_ID=

# Swarm manager URL (for API to API communication)
# SWARM_MANAGER_URL=https://manager-1.example.com

# ============================================================================
# REDIS CONFIGURATION (if using Redis)
# ============================================================================

# Redis connection URL (optional)
# Format: redis://host:port or redis://:password@host:port
# REDIS_URL=redis://redis:6379

# Redis cluster nodes (for HA deployments)
# Comma-separated list: host1:port1,host2:port2,host3:port3
# REDIS_CLUSTER_NODES=redis-1:6379,redis-2:6379,redis-3:6379

# ============================================================================
# NOTES
# ============================================================================
#
# Duration Format:
# - All duration values use Go's duration format: 5s (5 seconds), 1m (1 minute), 2h (2 hours)
# - Examples: 5s, 30s, 1m, 5m, 1h
#
# Password Generation:
# - Use: openssl rand -hex 32
# - This generates a 64-character hex string suitable for secrets
#
# Production Checklist:
# 1. Change all default passwords (POSTGRES_PASSWORD, etc.)
# 2. Generate secure secrets (JWT_SECRET, SESSION_SECRET)
# 3. Set LOG_LEVEL=info or warn (not debug)
# 4. Configure CORS properly (not "*")
# 5. Enable authentication (DISABLE_AUTH=false or remove it)
# 6. Set up SSL/TLS (DOMAIN and ACME_EMAIL)
# 7. Configure metrics database credentials separately
# 8. Tune metrics collection based on your workload
#
# For detailed documentation, see:
# - docs/reference/environment-variables.md
# - docs/getting-started/configuration.md
#
# ============================================================================
