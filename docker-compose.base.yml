# Docker Compose Base Configuration
# This file contains all shared environment variable blocks (x-common-*)
# These blocks are used across all docker-compose files via YAML anchors
#
# This file is automatically included by all compose files using the 'include' feature
# (Docker Compose v2.20+). This allows YAML anchors to work across files.

x-common-database: &common-database
  DB_HOST: ${DB_HOST:-postgres}
  DB_PORT: ${DB_PORT:-5432}
  DB_USER: ${POSTGRES_USER:-obiente_postgres}
  DB_PASSWORD: ${POSTGRES_PASSWORD:-obiente_postgres}
  DB_NAME: ${POSTGRES_DB:-obiente}

x-common-metrics-db: &common-metrics-db
  METRICS_DB_HOST: ${METRICS_DB_HOST:-timescaledb}
  METRICS_DB_PORT: ${METRICS_DB_PORT:-5432}
  METRICS_DB_USER: ${METRICS_DB_USER:-obiente_postgres}
  METRICS_DB_PASSWORD: ${METRICS_DB_PASSWORD:-obiente_postgres}
  METRICS_DB_NAME: ${METRICS_DB_NAME:-obiente_metrics}

x-common-auth: &common-auth
  LOG_LEVEL: ${LOG_LEVEL:-debug}
  DB_LOG_LEVEL: ${DB_LOG_LEVEL:-}
  CORS_ORIGIN: ${CORS_ORIGIN:-*}
  ZITADEL_URL: ${ZITADEL_URL:-https://auth.obiente.cloud}
  ZITADEL_CLIENT_ID: ${ZITADEL_CLIENT_ID:-}
  ZITADEL_MANAGEMENT_TOKEN: ${ZITADEL_MANAGEMENT_TOKEN:-}
  SUPERADMIN_EMAILS: ${SUPERADMIN_EMAILS:-}
  ZITADEL_ORGANIZATION_ID: ${ZITADEL_ORGANIZATION_ID:-}
  DISABLE_AUTH: ${DISABLE_AUTH:-false}
  SKIP_TLS_VERIFY: ${SKIP_TLS_VERIFY:-false}

x-common-smtp: &common-smtp
  SMTP_HOST: ${SMTP_HOST:-}
  SMTP_PORT: ${SMTP_PORT:-587}
  SMTP_USERNAME: ${SMTP_USERNAME:-}
  SMTP_PASSWORD: ${SMTP_PASSWORD:-}
  SMTP_FROM_ADDRESS: ${SMTP_FROM_ADDRESS:-}
  SMTP_FROM_NAME: ${SMTP_FROM_NAME:-Obiente Cloud}
  SMTP_REPLY_TO: ${SMTP_REPLY_TO:-}
  SMTP_USE_STARTTLS: ${SMTP_USE_STARTTLS:-true}
  SMTP_SKIP_TLS_VERIFY: ${SMTP_SKIP_TLS_VERIFY:-false}
  SMTP_TIMEOUT_SECONDS: ${SMTP_TIMEOUT_SECONDS:-10}
  SMTP_LOCAL_NAME: ${SMTP_LOCAL_NAME:-api.obiente.local}

x-common-dashboard: &common-dashboard
  DASHBOARD_URL: ${DASHBOARD_URL:-http://localhost:3000}
  SUPPORT_EMAIL: ${SUPPORT_EMAIL:-}
  SELF_HOSTED: ${SELF_HOSTED:-false}
  BILLING_ENABLED: ${BILLING_ENABLED:-true}

x-common-stripe: &common-stripe
  STRIPE_SECRET_KEY: ${STRIPE_SECRET_KEY:-}
  STRIPE_WEBHOOK_SECRET: ${STRIPE_WEBHOOK_SECRET:-}

x-common-redis: &common-redis
  REDIS_HOST: ${REDIS_HOST:-redis}
  REDIS_PORT: ${REDIS_PORT:-6379}
  REDIS_PASSWORD: ${REDIS_PASSWORD:-}
  REDIS_URL: ${REDIS_URL:-}

x-common-api-gateway: &common-api-gateway
  DOMAIN: ${DOMAIN:-localhost}
  USE_TRAEFIK_ROUTING: ${USE_TRAEFIK_ROUTING:-true}
  USE_DOMAIN_ROUTING: ${USE_DOMAIN_ROUTING:-true}

x-common-orchestrator: &common-orchestrator
  DOMAIN: ${DOMAIN:-localhost}
  ACME_EMAIL: ${ACME_EMAIL:-}
  REGISTRY_URL: ${REGISTRY_URL:-}
  REGISTRY_USERNAME: ${REGISTRY_USERNAME:-}
  REGISTRY_PASSWORD: ${REGISTRY_PASSWORD:-}
  ENABLE_SWARM: ${ENABLE_SWARM:-false}
  NODE_IPS: ${NODE_IPS:-127.0.0.1}
  API_BASE_URL: ${API_BASE_URL:-http://api-gateway:3001}
  DEPLOYMENT_STRATEGY: ${DEPLOYMENT_STRATEGY:-least-loaded}
  MAX_DEPLOYMENTS_PER_NODE: ${MAX_DEPLOYMENTS_PER_NODE:-50}
  USE_DOMAIN_ROUTING: ${USE_DOMAIN_ROUTING:-true}
  NODE_SUBDOMAIN: ${NODE_SUBDOMAIN:-}
  USE_NODE_SPECIFIC_DOMAINS: ${USE_NODE_SPECIFIC_DOMAINS:-false}
  SERVICE_DOMAIN_PATTERN: ${SERVICE_DOMAIN_PATTERN:-node-service}

x-common-vps: &common-vps
  VPS_REGIONS: ${VPS_REGIONS:-}
  PROXMOX_API_URL: ${PROXMOX_API_URL:-}
  PROXMOX_USERNAME: ${PROXMOX_USERNAME:-root@pam}
  PROXMOX_PASSWORD: ${PROXMOX_PASSWORD:-}
  PROXMOX_TOKEN_ID: ${PROXMOX_TOKEN_ID:-}
  PROXMOX_TOKEN_SECRET: ${PROXMOX_TOKEN_SECRET:-}
  PROXMOX_STORAGE_POOL: ${PROXMOX_STORAGE_POOL:-local-lvm}
  PROXMOX_VM_ID_START: ${PROXMOX_VM_ID_START:-}
  PROXMOX_VLAN_ID: ${PROXMOX_VLAN_ID:-}
  PROXMOX_SSH_HOST: ${PROXMOX_SSH_HOST:-}
  PROXMOX_SSH_USER: ${PROXMOX_SSH_USER:-obiente-cloud}
  PROXMOX_SSH_KEY_PATH: ${PROXMOX_SSH_KEY_PATH:-}
  PROXMOX_SSH_KEY_DATA: ${PROXMOX_SSH_KEY_DATA:-}
  VPS_GATEWAY_API_SECRET: ${VPS_GATEWAY_API_SECRET:-}
  VPS_GATEWAY_URL: ${VPS_GATEWAY_URL:-}
  VPS_GATEWAY_BRIDGE: ${VPS_GATEWAY_BRIDGE:-OCvpsnet}
  SSH_PROXY_PORT: ${SSH_PROXY_PORT:-2222}

x-common-dns-delegation: &common-dns-delegation
  DNS_DELEGATION_PRODUCTION_API_URL: ${DNS_DELEGATION_PRODUCTION_API_URL:-}
  DNS_DELEGATION_API_KEY: ${DNS_DELEGATION_API_KEY:-}
  DNS_DELEGATION_PUSH_INTERVAL: ${DNS_DELEGATION_PUSH_INTERVAL:-2m}
  DNS_DELEGATION_TTL: ${DNS_DELEGATION_TTL:-300s}

x-common-dns: &common-dns
  DNS_IPS: ${DNS_IPS:-}
  DNS_PORT: ${DNS_PORT:-53}
  DNS_HTTP_PORT: ${DNS_HTTP_PORT:-8053}
  ENABLE_DNS: ${ENABLE_DNS:-true}

x-common-security: &common-security
  SECRET: ${SECRET:-}
  RATE_LIMIT_WINDOW_MS: ${RATE_LIMIT_WINDOW_MS:-60000}
  RATE_LIMIT_MAX: ${RATE_LIMIT_MAX:-100}

x-common-github: &common-github
  GITHUB_CLIENT_ID: ${GITHUB_CLIENT_ID:-}
  GITHUB_CLIENT_SECRET: ${GITHUB_CLIENT_SECRET:-}

